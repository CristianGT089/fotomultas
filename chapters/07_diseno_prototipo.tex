\section{Diseño del prototipo}
Se hace mención de que, aunque la documentación para elaborar el software está en español, es un estándar escribir código en inglés y, por tanto, para mantener la coherencia, los diagramas mostrados a continuación usarán este idioma para los nombres de las variables, funciones y clases.
\subsection{Definición de requisitos}
    
\begin{enumerate}
    \item \textbf{Datos sobre infracciones de tráfico:} La captura de datos detallados sobre infracciones de tráfico, como la hora de la infracción, las coordenadas GPS, el tipo de infracción, los datos de identificación del vehículo e imágenes o vídeos, garantiza que cada incidente se documenta exhaustivamente. Este registro exhaustivo proporciona transparencia y responsabilidad, ya que los datos son inmutables y a prueba de manipulaciones una vez almacenados en la cadena de bloques. La inclusión de pruebas mediáticas refuerza aún más la credibilidad y verificabilidad de cada infracción, haciendo que los registros sean sólidos a efectos legales y administrativos. 
    \item \textbf{Información sobre el conductor:} Asociar las infracciones de tráfico a conductores concretos utilizando su dirección Ethereum (clave pública), los datos KYC si es necesario, y los números de identificación del conductor permite un seguimiento y una rendición de cuentas precisos. Esta vinculación permite al sistema personalizar el seguimiento y la verificación de las sanciones, garantizando que las sanciones se atribuyan correctamente a las personas adecuadas. El uso de datos KYC garantiza que las identidades de los conductores puedan verificarse de forma fiable, lo que resulta esencial para mantener la integridad y fiabilidad del sistema.
    \item \textbf{Datos de la sanción: }  Registrando los datos de la sanción, incluyendo el tipo de sanción, el importe de la sanción y el estado del pago de la sanción facilita la ejecución automatizada de las sanciones a través de contratos inteligentes. Esta automatización reduce la carga administrativa de y garantiza que las sanciones se apliquen de forma coherente y transparente. El registro inmutable de las sanciones y su estado de pago en la blockchain garantiza que el proceso sea justo y responsable, proporcionando una pista de auditoría clara para todas las transacciones financieras relacionadas con las infracciones de tráfico.
        \item \textbf{Eventos de contratos inteligentes:} El registro de eventos de contratos inteligentes, como el registro de nuevas infracciones de tráfico o la ejecución de sanciones, con datos relevantes y marcas de tiempo, garantiza que todas las acciones significativas se documenten de forma transparente. Este registro de eventos mejora la trazabilidad y la rendición de cuentas, proporcionando un registro cronológico de las actividades importantes del sistema. Esta transparencia es crucial para las auditorías y revisiones, ya que ayuda a generar confianza en las operaciones del sistema. 
        \item \textbf{Datos de las transacciones de la cadena de bloques: } El seguimiento de los datos de las transacciones de la cadena de bloques, incluido el hash de la transacción, las direcciones del remitente/receptor y las tarifas del gas, proporciona un registro detallado de todas las interacciones dentro del sistema. Estos datos permiten supervisar y auditar las transacciones, garantizando la transparencia y la trazabilidad. Además, hacer un seguimiento de las tarifas de gas ayuda a gestionar y optimizar los costes asociados a la ejecución de transacciones en la blockchain, que es importante para mantener la rentabilidad del sistema. 
        \item \textbf{Dispositivos de datos IoT:} La integración de datos de dispositivos IoT, como sensores o cámaras, junto con marcas de tiempo e identificación del dispositivo, puede mejorar las pruebas recopiladas para infracciones de tráfico. Estos datos en tiempo real proporcionan contexto adicional y pruebas corroborativas, haciendo que los registros de infracciones sean más sólidos y fiables. El uso de dispositivos IoT también puede automatizar la detección y el registro de infracciones, aumentando la eficiencia y la precisión del sistema.
            \item \textbf{Opiniones de los usuarios: } La recopilación de opiniones de los usuarios, incluidos el tipo de opinión, los comentarios y las valoraciones de los usuarios, ayuda a los administradores del sistema a comprender las experiencias y percepciones de los usuarios. Esta información es valiosa para identificar áreas de mejora en y mejorar la usabilidad y funcionalidad del sistema. Involucrar a los usuarios de esta manera puede conducir a un diseño del sistema más centrado en el usuario, mejorando la satisfacción y la eficacia general. 
                \item \textbf{Datos de cumplimiento: } El registro de los datos de cumplimiento, incluido el estado de cumplimiento y los detalles normativos, garantiza que el sistema se adhiere a las leyes y normativas de tráfico locales. Este seguimiento es vital para demostrar el cumplimiento de la normativa y evitar problemas legales. El mantenimiento de registros de cumplimiento detallados también facilita las auditorías reglamentarias en, proporcionando pruebas transparentes de que el sistema funciona dentro de las normas legales, lo que es esencial para generar confianza y credibilidad entre las partes interesadas.
\end{enumerate}
\subsection{Diagrama de casos de uso del sistema de gestión de infracciones de tránsito}
\begin{figure}[htbp]
    \begin{flushleft}
        \textbf{Figura 6}\\[2em]
        \textit{Diagrama de casos de uso del sistema de gestión de infracciones de tránsito}
    \end{flushleft}
    \vspace{1em}
    \addcontentsline{lof}{figure}{Figura 6. Diagrama de casos de uso del sistema de gestión de infracciones de tránsito}
    \centering
    \includegraphics[width=0.8\textwidth]{Images/CasosUso.png}
    \vspace{2em}
    \begin{flushleft}
        \textit{Nota.} Elaboración propia.
    \end{flushleft}
    \refstepcounter{figure}\label{fig:casos_uso}
\end{figure}

\subsection{Diagrama de despliegue}
\begin{figure}[htbp]
    \begin{flushleft}
        \textbf{Figura 7}\\[2em]
        \textit{Diagrama de despliegue de la arquitectura del sistema}
    \end{flushleft}
    \vspace{1em}
    \addcontentsline{lof}{figure}{Figura 7. Diagrama de despliegue de la arquitectura del sistema}
    \centering
    \includegraphics[width=0.8\textwidth]{Images/Despliegue.png}
    \vspace{2em}
    \begin{flushleft}
        \textit{Nota.} Elaboración propia.
    \end{flushleft}
    \refstepcounter{figure}\label{fig:diagrama_despliegue}
\end{figure}

En la Figura \ref{fig:diagrama_despliegue} se presenta la arquitectura híbrida propuesta, que combina una red blockchain privada (Hyperledger Fabric) con una blockchain pública (Ethereum), implementando el concepto de transparencia selectiva. La arquitectura se compone de los siguientes elementos:

\paragraph{Capa privada - Hyperledger Fabric}
\begin{itemize}
    \item \textbf{Nodos Peer:} Mantienen el ledger privado y ejecutan chaincode (lógica de negocio). Estos nodos almacenan la información completa de las infracciones, incluyendo datos sensibles y evidencias completas.
    \item \textbf{Nodo Orderer:} Coordina el consenso entre peers utilizando el algoritmo PBFT (Practical Byzantine Fault Tolerance), garantizando la validación eficiente de transacciones.
    \item \textbf{Certificate Authority (CA):} Gestiona las identidades digitales y permisos de usuarios autorizados (administradores, agentes de tránsito).
    \item \textbf{IPFS Privado:} Almacena las evidencias fotográficas completas con sus metadatos, accesible solo para usuarios autorizados.
\end{itemize}

\paragraph{Capa pública - Ethereum}
\begin{itemize}
    \item \textbf{Nodos Ethereum:} Ejecutan Smart Contracts que almacenan metadatos públicos de infracciones sin información personal sensible.
    \item \textbf{IPFS Público:} Almacena hashes de evidencias para verificación ciudadana, sin exponer imágenes completas.
\end{itemize}

\paragraph{Servicio de sincronización}
Un servicio intermediario sincroniza los datos entre ambas blockchains, extrayendo metadatos no sensibles de Hyperledger Fabric y publicándolos en Ethereum junto con hashes de integridad. Este servicio garantiza la consistencia entre ambas capas mediante verificación cruzada de hashes criptográficos.

La arquitectura se conecta mediante servicios web a APIs externas como Apitude para acceder a información del Registro Único Nacional de Tránsito (RUNT) y del Sistema Integrado de Información sobre Multas y Sanciones por Infracciones de Tránsito (SIMIT), obteniendo datos de conductores, vehículos y el estado de multas. Esta integración permite validar la información de infracciones contra registros oficiales sin comprometer la privacidad de los datos almacenados en la capa privada. 

\subsection{Diagrama de clases}
La arquitectura de clases del sistema implementa el patrón Controller-Service-Repository, adaptado para soportar la arquitectura híbrida blockchain. Se distinguen tres capas principales de lógica de negocio:

\paragraph{Primera capa - servicios de blockchain híbrida}
Gestiona la interacción con ambas blockchains de forma independiente:
\begin{itemize}
    \item \textbf{HyperledgerService:} Coordina operaciones con la red privada de Hyperledger Fabric, incluyendo registro completo de infracciones, gestión de apelaciones y control de acceso.
    \item \textbf{EthereumService:} Maneja la publicación de metadatos en la blockchain pública de Ethereum y proporciona interfaces de consulta ciudadana.
    \item \textbf{SyncService:} Implementa la lógica de sincronización entre blockchains, extrayendo metadatos públicos de Hyperledger y publicándolos en Ethereum con hashes de integridad.
\end{itemize}

\paragraph{Segunda capa - almacenamiento distribuido dual}
Separa el almacenamiento de evidencias según su nivel de sensibilidad:
\begin{itemize}
    \item \textbf{IPFSPrivateService:} Gestiona el almacenamiento de evidencias completas en IPFS privado, accesible solo para usuarios autorizados.
    \item \textbf{IPFSPublicService:} Maneja la publicación de hashes de evidencias en IPFS público para verificación ciudadana.
\end{itemize}

\paragraph{Tercera capa - orquestación y administración}
Coordina las operaciones entre todas las capas:
\begin{itemize}
    \item \textbf{FineService:} Orquesta el flujo completo de registro de infracciones, coordinando el almacenamiento en IPFS privado, registro en Hyperledger Fabric y sincronización a Ethereum.
    \item \textbf{FineController:} Expone endpoints REST para las operaciones del sistema, diferenciando entre operaciones internas (requieren autenticación) y consultas públicas.
\end{itemize} 
 \begin{figure}[htbp]
    \begin{flushleft}
        \textbf{Figura 8}\\[2em]
        \textit{Diagrama de clases del sistema de gestión de multas}
    \end{flushleft}
    \vspace{1em}
    \addcontentsline{lof}{figure}{Figura 8. Diagrama de clases del sistema de gestión de multas}
    \centering
    \includegraphics[width=0.8\textwidth]{Images/uml.png}
    \vspace{2em}
    \begin{flushleft}
        \textit{Nota.} Elaboración propia.
    \end{flushleft}
    \refstepcounter{figure}\label{fig:diagrama_clases}
\end{figure}
En la Figura \ref{fig:diagrama_clases} se presenta el diagrama de clases completo del sistema, mostrando la separación entre servicios de Hyperledger Fabric (privado), Ethereum (público) y el servicio de sincronización que coordina la interoperabilidad entre ambas blockchains. El diagrama ilustra cómo el patrón Repository abstrae el acceso a cada blockchain mediante repositorios especializados (HyperledgerRepository y EthereumRepository), mientras que el patrón Service encapsula la lógica de negocio específica de cada capa
 \begin{figure}[htbp]
    \begin{flushleft}
        \textbf{Figura 9}\\[2em]
        \textit{Diagrama de actividades para el proceso de apelación de multa}
    \end{flushleft}
    \vspace{1em}
    \addcontentsline{lof}{figure}{Figura 9. Diagrama de actividades para el proceso de apelación de multa}
    \centering
    \includegraphics[width=0.8\textwidth]{Images/ActApelacion.png}
    \vspace{2em}
    \begin{flushleft}
        \textit{Nota.} Elaboración propia.
    \end{flushleft}
    \refstepcounter{figure}\label{fig:diagrama_apelacion}
\end{figure}

En la Figura \ref{fig:diagrama_apelacion} se presenta el flujo de proceso para la gestión de apelaciones de multas en la arquitectura híbrida. Este proceso se ejecuta en la capa privada de Hyperledger Fabric, garantizando la confidencialidad de las evidencias presentadas por el ciudadano. Una vez resuelta la apelación por el agente autorizado, el cambio de estado se sincroniza a la blockchain pública de Ethereum, permitiendo que el ciudadano verifique la resolución sin acceder a información sensible del proceso interno.

\subsection{Diagrama de actividades}
 \begin{figure}[htbp]
    \begin{flushleft}
        \textbf{Figura 10}\\[2em]
        \textit{Diagrama de actividades para el proceso de creación de multa}
    \end{flushleft}
    \vspace{1em}
    \addcontentsline{lof}{figure}{Figura 10. Diagrama de actividades para el proceso de creación de multa}
    \centering
    \includegraphics[width=0.8\textwidth]{Images/ActMulta.png}
    \vspace{2em}
    \begin{flushleft}
        \textit{Nota.} Elaboración propia.
    \end{flushleft}
    \refstepcounter{figure}\label{fig:diagrama_creacion_multa}
\end{figure}

\subsection{Interfaz de usuario}
\paragraph{Compartidas}
 \begin{figure}[htbp]
    \begin{flushleft}
        \textbf{Figura 11}\\[2em]
        \textit{Pantalla de login del sistema}
    \end{flushleft}
    \vspace{1em}
    \addcontentsline{lof}{figure}{Figura 11. Pantalla de login del sistema}
    \centering
    \includegraphics[width=0.8\textwidth]{Images/UI1.png}
    \vspace{2em}
    \begin{flushleft}
        \textit{Nota.} Elaboración propia.
    \end{flushleft}
    \refstepcounter{figure}\label{fig:login}
\end{figure}

En la Figura~\ref{fig:login} se aprecia la pantalla de inicio de sesión, punto de entrada para todos los usuarios autorizados del sistema.

 \begin{figure}[htbp]
    \begin{flushleft}
        \textbf{Figura 12}\\[2em]
        \textit{Pantalla de recuperación de contraseña}
    \end{flushleft}
    \vspace{1em}
    \addcontentsline{lof}{figure}{Figura 12. Pantalla de recuperación de contraseña}
    \centering
    \includegraphics[width=0.8\textwidth]{Images/UI2.png}
    \vspace{2em}
    \begin{flushleft}
        \textit{Nota.} Elaboración propia.
    \end{flushleft}
    \refstepcounter{figure}\label{fig:recuperar_password}
\end{figure}
La Figura~\ref{fig:recuperar_password} muestra el formulario para recuperar la contraseña, reforzando la experiencia de autoservicio y seguridad de la plataforma.
\paragraph{Vista agente}
\begin{figure}[htbp]
    \begin{flushleft}
        \textbf{Figura 13}\\[2em]
        \textit{Dashboard del agente de tránsito}
    \end{flushleft}
    \vspace{1em}
    \addcontentsline{lof}{figure}{Figura 13. Dashboard del agente de tránsito}
    \centering
    \includegraphics[width=0.8\textwidth]{Images/UI3.png}
    \vspace{2em}
    \begin{flushleft}
        \textit{Nota.} Elaboración propia.
    \end{flushleft}
    \refstepcounter{figure}\label{fig:dashboard_agente}
\end{figure}
En la Figura~\ref{fig:dashboard_agente} se presenta el tablero principal que resume las métricas de gestión de multas para el agente de tránsito.
 \begin{figure}[htbp]
    \begin{flushleft}
        \textbf{Figura 14}\\[2em]
        \textit{Pantalla de consulta del estado de multa}
    \end{flushleft}
    \vspace{1em}
    \addcontentsline{lof}{figure}{Figura 14. Pantalla de consulta del estado de multa}
    \centering
    \includegraphics[width=0.8\textwidth]{Images/UI4.png}
    \vspace{2em}
    \begin{flushleft}
        \textit{Nota.} Elaboración propia.
    \end{flushleft}
    \refstepcounter{figure}\label{fig:consulta_estado_multa}
\end{figure}
La Figura~\ref{fig:consulta_estado_multa} ilustra la consulta rápida del estado de una multa, facilitando el seguimiento por parte del agente.
 \begin{figure}[htbp]
    \begin{flushleft}
        \textbf{Figura 15}\\[2em]
        \textit{Pantalla de consulta de detalle de multa}
    \end{flushleft}
    \vspace{1em}
    \addcontentsline{lof}{figure}{Figura 15. Pantalla de consulta de detalle de multa}
    \centering
    \includegraphics[width=0.8\textwidth]{Images/UI4.png}
    \vspace{2em}
    \begin{flushleft}
        \textit{Nota.} Elaboración propia.
    \end{flushleft}
    \refstepcounter{figure}\label{fig:consulta_detalle_multa}
\end{figure}
En la Figura~\ref{fig:consulta_detalle_multa} se muestra el detalle completo de una multa específica, incluida la evidencia asociada.
 \paragraph{Vista propietario de vehículo}
 \begin{figure}[htbp]
    \begin{flushleft}
        \textbf{Figura 16}\\[2em]
        \textit{Pantalla de consulta de multas para propietarios de vehículos}
    \end{flushleft}
    \vspace{1em}
    \addcontentsline{lof}{figure}{Figura 16. Pantalla de consulta de multas para propietarios de vehículos}
    \centering
    \includegraphics[width=0.8\textwidth]{Images/UI5.png}
    \vspace{2em}
    \begin{flushleft}
        \textit{Nota.} Elaboración propia.
    \end{flushleft}
    \refstepcounter{figure}\label{fig:consulta_multas_propietario}
\end{figure}
Por último, la Figura~\ref{fig:consulta_multas_propietario} exhibe la vista que permite al propietario del vehículo revisar todas sus multas pendientes o en proceso. 