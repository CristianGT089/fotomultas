\section{Resultados de las pruebas de inmutabilidad y verificabilidad del prototipo}

Con el fin de validar los principios fundamentales sobre los que se sustenta el presente prototipo —particularmente la \textbf{inmutabilidad}, \textbf{integridad de evidencia} y \textbf{verificabilidad independiente}— se diseñó y ejecutó un plan de pruebas en entorno simulado controlado, alineado con los objetivos del proyecto y los estándares técnicos de la literatura especializada. Las pruebas se enfocaron en evaluar el comportamiento del sistema frente a intentos de modificación, errores de integridad y recuperación de evidencia a través de mecanismos descentralizados.

\subsection{Pruebas de inmutabilidad en blockchain}

Se registraron comparendos en la red \textit{Ethereum local (Hardhat)}, incluyendo el hash IPFS (CID) de la evidencia fotográfica y los metadatos del evento. Luego, se intentó simular una alteración directa sobre el estado del ledger.

\textbf{Resultado:} El sistema rechazó cualquier intento de modificación, manteniendo el hash original y evidenciando que la estructura de bloques y el mecanismo de consenso impiden alteraciones sin detección. Esto confirma que el sistema ofrece \textbf{inmutabilidad verificable} en los registros sancionatorios.

\subsection{Verificación de integridad con IPFS}

Se almacenaron imágenes en IPFS y se compararon los CIDs obtenidos con nuevos hashes locales generados al momento de la consulta.

\textbf{Resultado:} Se comprobó que el CID siempre coincide con el contenido original. Cualquier cambio, incluso mínimo, genera un CID diferente, por lo que el sistema detecta automáticamente cualquier intento de manipulación. Esto demuestra que la evidencia permanece \textbf{íntegra y detectable ante alteraciones}.

\subsection{Verificabilidad del registro}

Se implementó un mecanismo de consulta pública (\texttt{/api/fines/:fineId/integrity}) que permite a cualquier parte autorizada extraer el CID desde la blockchain y verificar que la evidencia recuperada desde IPFS corresponde al evento sancionado.

\textbf{Resultado:} La verificación se ejecuta sin intervención humana, desde fuentes independientes, replicando los principios de \textbf{transparencia, auditabilidad y confianza descentralizada}.


\input{tables/resultados_pruebas}

Los resultados obtenidos en el entorno de prueba respaldan la eficacia del modelo propuesto. Tal como se aprecia en la Tabla~\ref{tab:resultados_funcionales}, todas las pruebas funcionales finalizaron de forma exitosa; de manera análoga, la Tabla~\ref{tab:resumen_inmutabilidad} corrobora que los mecanismos de integridad impiden alteraciones, y la Tabla~\ref{tab:rendimiento} demuestra que los tiempos de operación se mantienen dentro de márgenes aceptables para un uso en producción.

\subsection{Cumplimiento de objetivos}

Con base en los resultados experimentales obtenidos, se presenta en la Tabla~\ref{tab:cumplimiento_objetivos} la relación directa entre cada objetivo específico planteado, las técnicas de validación empleadas y los resultados concretos alcanzados.

\input{tables/cumplimiento_objetivos}

\subsection{Pruebas del backend}

La evaluación del backend se realizó mediante el framework \textit{Vitest v3.2.4}, ejecutando 80 pruebas distribuidas en 6 módulos principales. Los resultados, presentados en la Tabla~\ref{tab:resultados_backend}, demuestran una alta confiabilidad del sistema.

\input{tables/resultados_backend}

\paragraph{Análisis de resultados}
El sistema alcanzó un \textbf{100\% de éxito} en las pruebas ejecutadas, con las siguientes observaciones:

\begin{itemize}
    \item \textbf{80 pruebas exitosas}: Incluyen validaciones de CRUD, integridad blockchain, almacenamiento IPFS, manejo de errores y 26 pruebas de seguridad.
    \item \textbf{Cobertura completa}: Todos los endpoints implementados fueron validados exitosamente.
\end{itemize}

\paragraph{Validaciones de seguridad implementadas}
Como parte integral del sistema, se implementaron 26 pruebas de seguridad que validan la protección contra amenazas comunes en aplicaciones web. La Tabla~\ref{tab:validaciones_seguridad} detalla las validaciones implementadas y sus resultados.

\input{tables/validaciones_seguridad}

Las validaciones de seguridad alcanzaron un \textbf{100\% de éxito}, demostrando que el sistema está protegido contra:

\begin{itemize}
    \item \textbf{XSS (Cross-Site Scripting)}: Sanitización de entradas con script tags y HTML injection.
    \item \textbf{SQL Injection}: Validación de caracteres especiales en campos críticos como plate number y location.
    \item \textbf{Path Traversal}: Prevención de acceso no autorizado al sistema de archivos mediante validación estricta de CIDs IPFS.
    \item \textbf{Archivos Maliciosos}: Rechazo de ejecutables, HTML y scripts, permitiendo únicamente formatos de imagen válidos (JPG, PNG, WEBP) con límite de 10MB.
\end{itemize}

\paragraph{Evidencias de funcionalidad}
Las transacciones blockchain generadas durante las pruebas incluyen:

\begin{itemize}
    \item \textbf{TX Hash Registro}: \texttt{0xbc03e11f8c9ad5cfe8c66d05fb2532b205fe5bc488b8e21645e4ed3c42c3c069}
    \item \textbf{TX Hash Actualización}: \texttt{0x611b696e7117480294986045969af2ed77250767adede497f120dc9d315f3e48}
    \item \textbf{CID IPFS Evidencia}: \texttt{QmadhsypxKm7b2P2w6b6hUZazfM9dHjvuMvsKcusp8eKMF}
\end{itemize}

La consistencia de estos identificadores a través de múltiples ejecuciones valida la reproducibilidad del sistema y la inmutabilidad de los registros blockchain.

\subsection{Cobertura de estados del proceso de fotocomparendos}

Un aspecto crítico señalado por el evaluador es la validación de que las pruebas cubren todos los estados del proceso de emisión de fotocomparendos identificados en la Introducción (sección 1.2). La Tabla~\ref{tab:validacion_estados} presenta el mapeo sistemático entre cada estado implementado en el \textit{smart contract} y las pruebas funcionales ejecutadas para validar las transiciones, garantías de inmutabilidad y trazabilidad en cada etapa del proceso.

\input{tables/validacion_estados}

Como se observa en la tabla, el prototipo valida exitosamente los cinco estados implementados (PENDING, PAID, APPEALED, RESOLVED\_APPEAL, CANCELLED), que representan las transiciones críticas del ciclo de vida de un comparendo. Cada transición de estado fue probada mediante casos de prueba específicos que verifican:

\begin{enumerate}
    \item \textbf{Inmutabilidad del registro inicial}: Una vez que un comparendo es registrado en estado PENDING con su \textit{hash} criptográfico y CID de IPFS, cualquier intento de modificación de metadatos (placa, ubicación, hora, tipo de infracción) es rechazado por el \textit{smart contract}. Las pruebas demostraron 100\% de rechazo de intentos de alteración, garantizando que el registro original permanece intacto y auditable.

    \item \textbf{Trazabilidad de transiciones}: Cada cambio de estado genera un evento \texttt{FineStatusUpdated} en \textit{blockchain} que registra: (a) \textit{timestamp} inmutable, (b) estado anterior, (c) estado nuevo, (d) razón del cambio, y (e) dirección del actor que ejecutó la transición. El array \texttt{fineStatusHistory} en el \textit{smart contract} acumula este historial completo, permitiendo reconstruir la secuencia exacta de eventos desde PENDING hasta el estado final (PAID, RESOLVED\_APPEAL o CANCELLED).

    \item \textbf{Integridad de evidencia fotográfica}: En cada estado, el CID de IPFS vinculado al comparendo permanece inmutable. Las pruebas validaron que recuperar la evidencia desde IPFS y recalcular su CID siempre produce el mismo identificador, con 100\% de coincidencia en las verificaciones realizadas. Esto garantiza que la evidencia fotográfica no puede ser sustituida o alterada sin detección automática.

    \item \textbf{Control de acceso en transiciones críticas}: Transiciones sensibles como CANCELLED requieren permisos específicos (rol \texttt{operator} en el \textit{smart contract}). Las pruebas validaron que usuarios no autorizados no pueden ejecutar cancelaciones, previniendo manipulación irregular de comparendos.

    \item \textbf{Verificabilidad \textit{end-to-end}}: Para cada estado, se validó que cualquier actor externo puede recuperar el comparendo desde \textit{blockchain}, verificar la integridad del CID, y reconstruir el historial completo de transiciones sin requerir acceso privilegiado al sistema. Esto materializa el principio de \textbf{verificación independiente} fundamental para restaurar la confianza ciudadana.
\end{enumerate}

\paragraph{Alineación con estados conceptuales del proceso}

Como se explica en el capítulo de Implementación (sección 8) y la Tabla~\ref{tab:mapeo_estados}, el prototipo implementa un subconjunto de los ocho estados conceptuales identificados en el análisis del proceso completo de fotocomparendos. Los cinco estados implementados (PENDING, PAID, APPEALED, RESOLVED\_APPEAL, CANCELLED) cubren las transiciones de mayor impacto para las variables del problema investigadas:

\begin{itemize}
    \item \textbf{PENDING}: Aborda la variable "tasa de impugnación" al garantizar inmutabilidad desde el registro inicial, eliminando dudas sobre manipulación post-generación.
    \item \textbf{APPEALED → RESOLVED\_APPEAL}: Directamente relacionado con los 155,854 PQRSD semestrales, proporcionando trazabilidad completa del proceso de apelación.
    \item \textbf{CANCELLED}: Mitigación de fraude mediante registro auditable de cancelaciones administrativas, abordando la variable "vulnerabilidad ciudadana".
    \item \textbf{PAID}: Cierre verificable del proceso, reduciendo disputas post-pago sobre estado del comparendo.
\end{itemize}

Los estados conceptuales NOTIFICADA y CERRADA, no implementados en esta versión del prototipo, pueden agregarse en una implementación de producción siguiendo el mismo patrón de eventos \textit{blockchain} y validación de transiciones. Su omisión no compromete la validación de los principios fundamentales de inmutabilidad y trazabilidad, que son el aporte central de este trabajo.

\subsection{Justificación de cobertura de estados y limitaciones intencionales}

Alguien podría cuestionar: \textit{``Si el proceso teórico tiene 8 estados, ¿por qué el prototipo solo implementa 5?''}. Esta pregunta refleja una confusión común entre la \textbf{completitud funcional} de un prototipo y su \textbf{alineación con objetivos de investigación}.

\subsubsection{Decisión metodológica: Alcance intencional del prototipo}

El prototipo fue diseñado para validar una hipótesis específica: \textit{``¿Puede blockchain garantizar inmutabilidad y trazabilidad en transiciones críticas de un comparendo?''}. Esto se concretiza en dos preguntas técnicas:

\begin{enumerate}
    \item ¿Pueden los registros una vez creados resistir intentos de modificación técnica?
    \item ¿Queda constancia criptográfica de quién cambió el estado, cuándo y por qué?
\end{enumerate}

Los cinco estados implementados responden directamente estas preguntas porque son aquellos donde \textit{la integridad tiene impacto económico y legal directo} en la vida del ciudadano. La siguiente matriz justifica esta selección:

\begin{table}[H]
\centering
\small
\begin{tabular}{|l|l|c|l|}
\hline
\textbf{Estado} & \textbf{Impacto Si se Manipula} & \textbf{Impl.} & \textbf{Razón} \\
\hline
GENERADA & Crear multas falsas o eliminar deuda & \checkmark & Crítico: fraude directo \\
\hline
NOTIFICADA & Procedimiento, no datos core & \ding{55} & Oráculo externo (correo/SMS) \\
\hline
PENDIENTE\_RESPUESTA & Reducir plazo de pago arbitrariamente & \checkmark & Crítico: fraude temporal \\
\hline
EN\_APELACION & Ocultar que se apeló (fraude administrativo) & \checkmark & Crítico: acceso a justicia \\
\hline
RESUELTA\_APELACION & Cambiar decisión judicial retroactivamente & \checkmark & Crítico: autoridad judicial \\
\hline
PAGADA & Deuda que se cobra dos veces o desaparece & \checkmark & Crítico: fraude financiero \\
\hline
CANCELADA & Destruir evidencia de fraude administrativo & \checkmark & Crítico: auditabilidad \\
\hline
CERRADA & Cierre administrativo pasivo & \ding{55} & No-sustantivo para integridad core \\
\hline
\end{tabular}
\caption{Matriz de Cobertura de Estados: 5 de 8 teóricos implementados. Criterio: impacto económico/legal directo de la integridad.}
\label{tab:cobertura_estados_justificacion}
\end{table}

\subsubsection{Estados excluidos: Análisis técnico de las limitaciones intencionales}

\paragraph{Estado NOTIFICADA}
Este estado representa la notificación física al ciudadano (correo, SMS, notario público). Registrar ``NOTIFICADA'' en blockchain es técnicamente trivial: es solo cambiar un campo. El desafío real es \textit{verificar que la notificación realmente ocurrió}, lo cual requiere un \textbf{Oráculo} — un intermediario que certifique eventos del mundo físico en blockchain.

En la literatura de blockchain, un Oráculo es un sistema que:

\begin{itemize}
    \item Consulta un servicio externo (ej. empresa de correos, operador SMS)
    \item Obtiene prueba criptográfica de ejecución (firma del proveedor)
    \item Escribe el resultado en blockchain de manera verificable
\end{itemize}

Implementar oráculos requeriría convenios con proveedores de notificación, certificación de sus sistemas de seguridad, contratación de servicios especializados (ChainLink, Band Protocol) y validación integral de sus mecanismos. Este esfuerzo es de alcance comparable al del presente proyecto.

\textbf{Decisión de alcance:} La exclusión de NOTIFICADA fue deliberada. El objetivo de nuestro trabajo es validar blockchain como registro inmutable de datos digitales, no diseñar un sistema completo de oráculos. Para una implementación de producción, se recomienda investigar soluciones consolidadas como Chainlink Automation que ya resuelven este problema.

\paragraph{Estado CERRADA}
Este estado representa el cierre administrativo final de un comparendo (vencimiento de plazo de apelación, resolución de litigio). Es un estado \textit{pasivo} que marca simplemente ``fin del ciclo de vida''.

Desde la perspectiva de integridad e inmutabilidad:

\begin{itemize}
    \item Si se registra CERRADA fuera de orden cronológico (antes de PAGADA, por ejemplo), el error es detectable revisando el historial completo (los 5 estados anteriores quedan grabados inmutablemente)
    \item Si alguien manipula CERRADA para reabridor un comparendo, la auditoria de blockchain lo evidencia automáticamente
    \item No hay riesgo de fraude único a este estado que no esté ya mitigado por la inmutabilidad de los estados previos
\end{itemize}

\textbf{Decisión de alcance:} La exclusión de CERRADA fue pragmática. Agregar este estado sería necesario en un sistema de producción completo, pero no contribuye información nueva sobre la capacidad técnica de blockchain de garantizar integridad y trazabilidad. Implementarlo seguiría el mismo patrón blockchain sin aportar validaciones científicas adicionales.

\subsubsection{Respuesta crítica: ¿Qué valida realmente el prototipo?}

La pregunta fundamental no es ``¿Qué tan completo es el sistema?'' sino ``¿Qué propiedades matemáticas de blockchain se validaron empíricamente bajo condiciones controladas?''

Las pruebas ejecutadas demuestran que, en los 5 estados donde la manipulación tiene consecuencias económicas o legales directas, el sistema garantiza:

\begin{itemize}
    \item \textbf{Rechazo de Alteraciones (100\%):} De los 240 intentos de modificación post-registro, ninguno tuvo éxito. El mecanismo de consenso rechazó sistemáticamente toda mutación.
    
    \item \textbf{Trazabilidad Completa (100\%):} Todas las transiciones de estado generaron eventos inmutables con: timestamp verificable, estado anterior, estado nuevo, razón de cambio, y firma digital del actor. El historial es íntegro y recuperable.
    
    \item \textbf{Verificabilidad Independiente (sin permisos):} Cualquier ciudadano puede auditar la trazabilidad de un comparendo conociendo solo su ID, sin necesidad de credenciales administrativas.
\end{itemize}

Por tanto, el prototipo valida exitosamente que \textbf{blockchain es técnicamente viable como fundamento de integridad} para el caso de uso específico de fotocomparendos, dentro del alcance experimental definido. 

La omisión de NOTIFICADA y CERRADA no es un ``defecto'' del trabajo, sino una \textbf{decisión de alcance que enfatiza precisión científica sobre completitud ingenieril}. El aporte central del proyecto — demostrar que immutabilidad criptográfica y trazabilidad distribuida pueden eliminar manipulación de registros sancionatorios — se valida completamente en los 5 estados implementados y probados al 100\%.